# $Id: static route on local wireless ,v 1.2 2010/10/01 jgilmore

ESSID_MINE=linksys_OW_25001
INTERFACE_MINE=wlan0

case "$reason" in
	BOUND|RENEW|REBOOT)
	if [ "$interface" = "$INTERFACE_MINE" ]; then
		#Check. If ESSID has been set to our local ESSID, create a static
		# IP
		/sbin/iwconfig "$interface" | grep "linksys_OW_25001" >/dev/null
		if [ $? -eq "0" ]; then
			#Find our hostname in /etc/hosts, and try to grab our ip address.
			hostname=`cat /etc/hostname`
			IP_MINE=`cat /etc/hosts | grep $hostname | sed 's/.*\(192\.168\.[0-9]\{1,3\}\.[0-9]\{1,3\}\).*/\1/'`
			if echo $IP_MINE | grep '192\.168\.[0-9]\{1,3\}\.[0-9]\{1,3\}'; then
				#Lie about the dhcp response we got.
				logger "the script in /etc/dhcp3/dhclient-enter-scripts.d/static-route-on-local-wireless just lied about dhclient assigned IP addresses."
				logger "The assigned ip address was $new_ip_address, but we're going to use $IP_MINE"
				new_ip_address=$IP_MINE
			else
				#Failed to automatically determine IP address.
				logger "The automatic IP fetching schema failed for /etc/dhcp3/dhclient-enter-scripts.d/static-route-on-local-wireless, we got $IP_MINE, using assigned $new_ip_address"
			fi
		fi
	fi
	;;
esac
